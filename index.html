
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulaire Anglais - Révision</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <style>
        :root {
            --color-background: #0a0a0f;
            --color-card: #1a1a24;
            --color-text: #E8E8F0;
            --color-primary: #BB86FC;
            --color-secondary: #03DAC6;
            --color-correct: #4CAF50;
            --color-incorrect: #F44336;
            --color-glow: rgba(187, 134, 252, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 20px var(--color-glow); }
            50% { box-shadow: 0 0 40px var(--color-glow), 0 0 60px var(--color-glow); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        @keyframes fadeIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a24 100%);
            color: var(--color-text);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(187, 134, 252, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(26, 26, 36, 0.7);
            backdrop-filter: blur(20px);
            padding: 50px 40px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 1px rgba(187, 134, 252, 0.2);
            text-align: center;
            min-height: 90vh;
            position: relative;
            z-index: 1;
            border: 1px solid rgba(187, 134, 252, 0.1);
        }

        h1 {
            font-weight: 800;
            font-size: 3.5em;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #BB86FC 0%, #03DAC6 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-shift 3s ease infinite;
            text-align: left;
            letter-spacing: -1px;
        }
        
        .alert-message {
            color: #FFFFFF;
            padding: 16px 20px;
            border-radius: 12px;
            font-weight: 600;
            margin-bottom: 30px;
            text-align: left;
            display: none;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideIn 0.5s ease-out;
        }

        .chapter-selector {
            display: flex;
            justify-content: flex-start;
            gap: 10px;
            margin-bottom: 35px;
            flex-wrap: wrap;
            padding: 5px 0;
        }
        
        .chapter-selector button {
            background: rgba(51, 51, 51, 0.6);
            backdrop-filter: blur(10px);
            color: var(--color-text);
            border: 2px solid transparent;
            padding: 10px 18px;
            font-size: 0.95em;
            font-weight: 700;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .chapter-selector button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(187, 134, 252, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .chapter-selector button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .chapter-selector button:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        .chapter-selector button.active {
            background: linear-gradient(135deg, var(--color-primary) 0%, #9966CC 100%);
            color: var(--color-card);
            border-color: var(--color-primary);
            box-shadow: 0 4px 15px var(--color-glow);
        }
        
        .mode-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 45px;
        }

        .mode-selector button {
            background: rgba(44, 44, 44, 0.6);
            backdrop-filter: blur(15px);
            color: var(--color-primary);
            border: 2px solid rgba(187, 134, 252, 0.2);
            padding: 25px 15px;
            font-size: 1.05em;
            font-weight: 700;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            line-height: 1.4;
            position: relative;
            overflow: hidden;
        }

        .mode-selector button::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(187, 134, 252, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .mode-selector button:hover::after {
            opacity: 1;
        }

        .mode-selector button:hover {
            border-color: var(--color-primary);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 8px 25px rgba(187, 134, 252, 0.3);
        }

        .mode-selector button.active {
            background: linear-gradient(135deg, var(--color-primary) 0%, #9966CC 100%);
            color: #FFFFFF;
            border-color: var(--color-primary);
            box-shadow: 0 8px 30px var(--color-glow);
            animation: glow-pulse 2s ease-in-out infinite;
        }
        
        .mode-selector button i {
            font-size: 1.8em;
            margin-bottom: 8px;
            transition: transform 0.3s;
        }

        .mode-selector button:hover i {
            transform: scale(1.15) rotate(5deg);
        }
        
        .mode-selector button.active i {
             color: #FFFFFF;
        }
        
        .mode-selector button:not(.active) i {
             color: var(--color-primary);
        }
        
        .game-container {
            display: none;
            padding: 30px;
            background: rgba(44, 44, 44, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            margin-bottom: 35px;
            min-height: 280px;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
            pointer-events: none;
            border: 1px solid rgba(187, 134, 252, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .game-container.active-mode {
             pointer-events: auto;
        }
        
        .card-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 220px;
            perspective: 1200px;
            margin-bottom: 35px;
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .card:hover {
            transform: scale(1.02);
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.2em;
            font-weight: 700;
            padding: 25px;
            box-sizing: border-box;
            word-wrap: break-word;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-front {
            background: linear-gradient(135deg, rgba(58, 58, 58, 0.9) 0%, rgba(44, 44, 44, 0.9) 100%);
            color: var(--color-text);
        }

        .card-back {
            background: linear-gradient(135deg, var(--color-primary) 0%, #9966CC 100%);
            color: #FFFFFF;
            transform: rotateY(180deg);
            font-size: 1.3em;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        #cardCounter, .quiz-score, #matchScore {
            font-size: 1.3em;
            font-weight: 700;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .feedback-buttons {
            display: none;
            flex-direction: row;
            gap: 18px;
            margin-top: 25px;
            justify-content: center;
        }

        .feedback-buttons button {
            width: 50%;
            padding: 16px;
            font-size: 1.1em;
            border-radius: 12px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #FFFFFF;
            position: relative;
            overflow: hidden;
        }

        .feedback-buttons button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .feedback-buttons button:hover::before {
            width: 300px;
            height: 300px;
        }

        .feedback-buttons .knew-it-btn {
            background: var(--color-correct);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }
        
        .feedback-buttons .knew-it-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6);
        }

        .feedback-buttons .didnt-know-it-btn {
            background: var(--color-incorrect);
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
        }
        
        .feedback-buttons .didnt-know-it-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(244, 67, 54, 0.6);
        }
        
        .quiz-question {
            font-size: 1.9em;
            font-weight: 700;
            margin-bottom: 35px;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        #quizGameContainer .quiz-options button {
            padding: 18px;
            background: rgba(58, 58, 58, 0.6);
            backdrop-filter: blur(10px);
            color: var(--color-text);
            font-size: 1em;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 2px solid rgba(85, 85, 85, 0.6);
            cursor: pointer;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        #quizGameContainer .quiz-options button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(187, 134, 252, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        #quizGameContainer .quiz-options button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        #quizGameContainer .quiz-options button:hover:not(.correct):not(.incorrect) {
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(187, 134, 252, 0.3);
        }

        #quizGameContainer .quiz-options button.correct {
            background: linear-gradient(135deg, var(--color-correct) 0%, #388E3C 100%);
            color: #FFFFFF;
            border-color: var(--color-correct);
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.5);
        }

        #quizGameContainer .quiz-options button.incorrect {
            background: linear-gradient(135deg, var(--color-incorrect) 0%, #D32F2F 100%);
            color: #FFFFFF;
            border-color: var(--color-incorrect);
            box-shadow: 0 4px 20px rgba(244, 67, 54, 0.5);
        }

        .hangman-drawing {
            margin: 20px auto;
            max-width: 200px;
        }
        
        .hangman-word {
            font-size: 2.8em;
            letter-spacing: 15px;
            margin-bottom: 35px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hangman-letters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .hangman-letters button {
            width: 48px;
            height: 48px;
            padding: 0;
            font-size: 1.15em;
            font-weight: 700;
            border-radius: 10px;
            background: rgba(58, 58, 58, 0.6);
            backdrop-filter: blur(10px);
            color: var(--color-text);
            border: 2px solid rgba(187, 134, 252, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .hangman-letters button:hover:not(:disabled) {
            background: rgba(68, 68, 68, 0.8);
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(187, 134, 252, 0.3);
        }
        
        .hangman-letters button:disabled {
            background: rgba(34, 34, 34, 0.4);
            color: #555555;
            cursor: not-allowed;
            border-color: transparent;
        }

        #scrambleInput, #dictationInput {
            padding: 16px 20px;
            width: 90%;
            max-width: 500px;
            border: 2px solid rgba(187, 134, 252, 0.3);
            border-radius: 12px;
            font-size: 1.6em;
            text-align: center;
            background: rgba(51, 51, 51, 0.6);
            backdrop-filter: blur(10px);
            color: var(--color-text);
            transition: all 0.3s ease;
            font-weight: 600;
        }

        #scrambleInput:focus, #dictationInput:focus {
            outline: none;
            border-color: var(--color-secondary);
            box-shadow: 0 0 20px rgba(3, 218, 198, 0.4), 0 0 40px rgba(3, 218, 198, 0.2);
            background: rgba(51, 51, 51, 0.8);
        }

        .scramble-clue, .dictation-clue {
            font-size: 1.15em;
            color: #CCCCCC;
            margin-bottom: 25px;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-weight: 500;
        }
        
        .scramble-feedback, .dictation-feedback {
            font-weight: 700;
            margin-top: 15px;
            min-height: 25px;
            font-size: 1.15em;
        }

        .game-container button:not(#scrambleNextBtn, #dictationNextBtn, #matchNextBtn, .knew-it-btn, .didnt-know-it-btn) {
            background: linear-gradient(135deg, var(--color-primary) 0%, #9966CC 100%);
            color: #FFFFFF;
            border: none;
            padding: 14px 30px;
            font-size: 1.05em;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(187, 134, 252, 0.4);
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .game-container button:not(#scrambleNextBtn, #dictationNextBtn, #matchNextBtn)::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .game-container button:not(#scrambleNextBtn, #dictationNextBtn, #matchNextBtn):hover::before {
            width: 300px;
            height: 300px;
        }

        .game-container button:hover:not(:disabled, #scrambleNextBtn, #dictationNextBtn, #matchNextBtn) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(187, 134, 252, 0.6);
        }
        
        #scrambleNextBtn, #dictationNextBtn, #matchNextBtn {
            background: linear-gradient(135deg, var(--color-secondary) 0%, #018786 100%);
            color: #FFFFFF;
            border: none;
            padding: 14px 30px;
            font-size: 1.05em;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(3, 218, 198, 0.4);
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        #scrambleNextBtn::before, #dictationNextBtn::before, #matchNextBtn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        #scrambleNextBtn:hover::before, #dictationNextBtn:hover::before, #matchNextBtn:hover::before {
            width: 300px;
            height: 300px;
        }

        #scrambleNextBtn:hover, #dictationNextBtn:hover, #matchNextBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(3, 218, 198, 0.6);
        }

        #matchGrid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-top: 25px;
            width: 100%;
        }

        .match-column {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .match-item {
            padding: 16px;
            background: rgba(58, 58, 58, 0.6);
            backdrop-filter: blur(10px);
            color: var(--color-text);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 0.95em;
            min-height: 55px;
            display: flex;
            align-items: center;
            border: 2px solid transparent;
            font-weight: 500;
        }

        .match-item:hover:not(.matched):not(.error) {
            background: rgba(68, 68, 68, 0.8);
            border-color: var(--color-primary);
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(187, 134, 252, 0.3);
        }

        .match-item.selected {
            border-color: var(--color-primary);
            background: rgba(187, 134, 252, 0.2);
            transform: scale(1.03);
            box-shadow: 0 4px 20px var(--color-glow);
        }

        .match-item.matched {
            background: linear-gradient(135deg, var(--color-correct) 0%, #388E3C 100%);
            color: #FFFFFF;
            cursor: default;
            pointer-events: none;
            opacity: 1;
            border-color: transparent;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.4);
        }

        .match-item.error {
            background: linear-gradient(135deg, var(--color-incorrect) 0%, #D32F2F 100%);
            color: #FFFFFF;
            animation: shake 0.5s;
            border-color: transparent;
        }

        details {
            margin-top: 30px;
            background: rgba(44, 44, 44, 0.4);
            backdrop-filter: blur(15px);
            border-radius: 14px;
            overflow: hidden;
            border: 1px solid rgba(187, 134, 252, 0.1);
        }
        
        summary {
            font-size: 1.25em;
            font-weight: 700;
            padding: 22px;
            cursor: pointer;
            outline: none;
            background: linear-gradient(135deg, var(--color-secondary) 0%, #018786 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        summary:hover {
            background: rgba(58, 58, 58, 0.6);
            -webkit-text-fill-color: var(--color-secondary);
        }

        summary::after {
            content: '\25BC';
            margin-left: 10px;
            transition: transform 0.3s;
            color: var(--color-secondary);
        }

        details[open] summary::after {
            content: '\25B2';
            transform: rotate(180deg);
        }
        
        .list-content, .instructions-content {
            padding: 0 22px 22px 22px;
            text-align: left;
            max-height: 0;
            transition: max-height 0.4s ease-out, border-top 0.4s;
            overflow: hidden;
            border-top: none;
        }
        
        details[open] .list-content,
        details[open] .instructions-content {
            max-height: 10000px;
            border-top: 1px solid rgba(187, 134, 252, 0.2);
        }

        .vocabulary-list {
            columns: 2;
            column-gap: 45px;
            font-size: 0.95em;
            line-height: 1.9;
            padding-left: 22px;
            margin-top: 18px;
        }
        
        .vocabulary-list li {
            margin-bottom: 6px;
            transition: color 0.2s;
        }

        .vocabulary-list li:hover {
            color: var(--color-primary);
        }

        .instructions-content p {
            margin-top: 18px;
            line-height: 1.7;
            color: #CCCCCC;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: rgba(26, 26, 36, 0.95);
            backdrop-filter: blur(30px);
            margin: auto;
            padding: 35px;
            border-radius: 20px;
            width: 85%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8), 0 0 1px rgba(187, 134, 252, 0.5);
            text-align: center;
            transform: translateY(-20px);
            opacity: 0;
            animation: fadeIn 0.4s forwards ease-out;
            border: 1px solid rgba(187, 134, 252, 0.2);
        }

        .modal-content h3 {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 28px;
            font-size: 1.6em;
            font-weight: 800;
        }

        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .modal-buttons button {
            width: 100%;
            padding: 16px;
            font-size: 1.15em;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #FFFFFF;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .modal-buttons button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .modal-buttons button:hover::before {
            width: 400px;
            height: 400px;
        }

        .modal-buttons button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.5);
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 25px 18px;
                min-height: 95vh;
            }
            h1 {
                font-size: 2.2em;
                margin-bottom: 20px;
            }
            
            .chapter-selector {
                justify-content: center;
            }
            .chapter-selector button {
                flex-grow: 1;
                min-width: unset;
                padding: 10px 14px;
                font-size: 0.9em;
            }
            
            .mode-selector {
                grid-template-columns: repeat(2, 1fr);
                gap: 14px;
            }
            
            .mode-selector button {
                padding: 18px 12px;
                font-size: 0.95em;
            }

            .mode-selector button i {
                font-size: 1.6em;
            }
            
            .card-face {
                font-size: 1.6em;
                padding: 20px;
            }
            
            .card-back {
                font-size: 1.1em;
            }

            .controls {
                gap: 12px;
            }
            
            .feedback-buttons {
                 flex-direction: column;
                gap: 12px;
            }
            
            .feedback-buttons button {
                width: 100%;
                font-size: 1em;
                padding: 14px;
            }

            .quiz-question {
                font-size: 1.5em;
                min-height: 70px;
            }

            .quiz-options {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            .quiz-options button {
                font-size: 0.95em;
                padding: 14px;
            }
            
            .hangman-word {
                font-size: 2em;
                letter-spacing: 10px;
            }
            .hangman-letters button {
                width: 40px;
                height: 40px;
                font-size: 1em;
            }

            #scrambleInput, #dictationInput {
                font-size: 1.3em;
                padding: 14px 16px;
            }
            .scramble-clue, .dictation-clue {
                font-size: 1em;
            }
            .game-container button {
                padding: 12px 22px;
                font-size: 0.95em;
            }
            
            #matchGrid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            .match-item {
                font-size: 0.9em;
                padding: 14px;
                min-height: 48px;
            }

            summary {
                font-size: 1.15em;
                padding: 18px;
            }
            .list-content, .instructions-content {
                padding: 0 18px 18px 18px;
            }
            .vocabulary-list {
                padding-left: 18px;
                font-size: 0.9em;
                column-gap: 30px;
            }
            .modal-content {
                width: 92%;
                padding: 25px;
            }
            .modal-content h3 {
                font-size: 1.4em;
                margin-bottom: 22px;
            }
            .modal-buttons button {
                font-size: 1em;
                padding: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="mainTitle">Vocabulaire Anglais</h1>
        <div id="chapterSelector" class="chapter-selector">
        </div>
        <div id="alertMessage" class="alert-message">
            <p id="alertText"></p>
        </div>
        <div class="mode-selector">
            <button id="flashcardModeBtn" class="active" title="Mode Cartes"><i class="fas fa-redo-alt"></i> Mode Cartes</button>
            <button id="quizModeBtn" title="Mode Quiz"><i class="fas fa-question-circle"></i> Mode Quiz</button>
            <button id="hangmanModeBtn" title="Mode Pendu"><i class="fas fa-user-slash"></i> Mode Pendu</button>
            <button id="scrambleModeBtn" title="Mode Réarrangement"><i class="fas fa-random"></i> Mots Mélangés</button>
            <button id="dictationModeBtn" title="Mode Dictée"><i class="fas fa-keyboard"></i> Mode Dictée</button>
            <button id="matchModeBtn" title="Mode Match"><i class="fas fa-link"></i> Mode Association</button>
        </div>

        <div id="flashcardGameContainer" class="game-container active-mode" style="display: flex; opacity: 1;">
            <div class="card-container">
                <div id="flashcard" class="card">
                    <div id="front" class="card-face card-front">Sélectionnez un chapitre ci-dessus</div>
                    <div id="back" class="card-face card-back">Puis une section pour commencer à jouer.</div>
                </div>
            </div>
            <div class="controls"> 
                <span id="cardCounter"></span>
            </div>
            <div class="feedback-buttons" id="feedbackButtons">
                <button class="knew-it-btn" id="knewItBtn">Je l'avais</button>
                <button class="didnt-know-it-btn" id="didntKnowBtn">Je ne l'avais pas</button>
            </div>
        </div>

        <div id="quizGameContainer" class="game-container">
            <div id="quizScore" class="quiz-score">Score: 0 / 0</div>
            <div id="quizQuestion" class="quiz-question"></div>
            <div id="quizOptions" class="quiz-options"></div>
        </div>

        <div id="hangmanGameContainer" class="game-container">
             <svg class="hangman-drawing" viewBox="0 0 200 200">
                <line x1="10" y1="190" x2="150" y2="190" stroke="#fff" stroke-width="4" />
                <line x1="40" y1="190" x2="40" y2="20" stroke="#fff" stroke-width="4" />
                <line x1="40" y1="20" x2="120" y2="20" stroke="#fff" stroke-width="4" />
                <line x1="120" y1="20" x2="120" y2="40" stroke="#fff" stroke-width="4" />

                <circle id="head" cx="120" cy="55" r="15" stroke="#fff" stroke-width="3" fill="none" style="display:none" />
                <line id="body" x1="120" y1="70" x2="120" y2="120" stroke="#fff" stroke-width="3" style="display:none" />
                <line id="arm1" x1="120" y1="80" x2="100" y2="100" stroke="#fff" stroke-width="3" style="display:none" />
                <line id="arm2" x1="120" y1="80" x2="140" y2="100" stroke="#fff" stroke-width="3" style="display:none" />
                <line id="leg1" x1="120" y1="120" x2="100" y2="150" stroke="#fff" stroke-width="3" style="display:none" />
                <line id="leg2" x1="120" y1="120" x2="140" y2="150" stroke="#fff" stroke-width="3" style="display:none" />
            </svg>
            <div id="hangmanWord" class="hangman-word"></div>
            <div id="hangmanLetters" class="hangman-letters"></div>
        </div>

        <div id="scrambleGameContainer" class="game-container">
            <div id="scrambleWord" class="quiz-question"></div>
            <div id="scrambleClue" class="scramble-clue"></div>
            <input type="text" id="scrambleInput" placeholder="Écris le mot ici..." autocomplete="off">
            <button id="scrambleCheckBtn">Vérifier</button>
            <div id="scrambleFeedback" class="scramble-feedback"></div>
            <button id="scrambleNextBtn" style="display:none;">Mot Suivant &rarr;</button>
        </div>

        <div id="dictationGameContainer" class="game-container">
            <div id="dictationClue" class="dictation-clue"></div>
            <input type="text" id="dictationInput" placeholder="Écris le mot exact ici..." autocomplete="off">
            <button id="dictationCheckBtn">Vérifier</button>
            <div id="dictationFeedback" class="dictation-feedback"></div>
            <button id="dictationNextBtn" style="display:none;">Mot Suivant &rarr;</button>
        </div>

        <div id="matchGameContainer" class="game-container">
            <div id="matchScore">Paires trouvées : 0 / 6</div>
            <div id="matchGrid">
                <div id="wordsColumn" class="match-column"></div>
                <div id="definitionsColumn" class="match-column"></div>
            </div>
            <button id="matchNextBtn" style="display:none; margin-top: 30px;">Prochain Match &rarr;</button>
        </div>

        <details>
            <summary id="listTitle">Liste Complète</summary>
            <div class="list-content">
                <ul class="vocabulary-list"></ul>
            </div>
        </details>

        <details>
            <summary>Comment Utiliser</summary>
            <div class="instructions-content">
                <p>
                    - **Sélecteur de Chapitre** : Choisis la catégorie de vocabulaire à réviser en haut de la page.
                    - **Mode Cartes** : Clique sur la carte pour voir la définition, puis dis si tu l'avais ou non. Les mots non connus reviendront plus souvent.
                    - **Mode Quiz** : Lis le mot ou la définition et choisis la bonne réponse.
                    - **Mode Pendu** : Devine le mot en cliquant sur les lettres.
                    - **Mots Mélangés** : Un mot est mélangé, retrouve le mot original avec l'aide de sa définition.
                    - **Mode Dictée** : Écris le mot exact correspondant à la définition. (Attention aux accents et à l'orthographe exacte).
                    - **Mode Association** : Associe les mots à leur définition en cliquant sur une paire.
                </p>
            </div>
        </details>
    </div>

    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle"></h3>
            <div id="modalButtons" class="modal-buttons">
            </div>
        </div>
    </div>

    <script src="vocab_data.js"></script>
    <script>
        const container = document.querySelector('.container');
        const flashcard = document.getElementById('flashcard');
        const frontFace = document.getElementById('front');
        const backFace = document.getElementById('back');
        const cardCounter = document.getElementById('cardCounter');
        const vocabularyList = document.querySelector('.vocabulary-list');
        const feedbackButtons = document.getElementById('feedbackButtons');
        const knewItBtn = document.getElementById('knewItBtn');
        const didntKnowBtn = document.getElementById('didntKnowBtn');

        const flashcardModeBtn = document.getElementById('flashcardModeBtn');
        const quizModeBtn = document.getElementById('quizModeBtn');
        const hangmanModeBtn = document.getElementById('hangmanModeBtn');
        const scrambleModeBtn = document.getElementById('scrambleModeBtn');
        const dictationModeBtn = document.getElementById('dictationModeBtn');
        const matchModeBtn = document.getElementById('matchModeBtn');

        const flashcardGameContainer = document.getElementById('flashcardGameContainer');
        const quizGameContainer = document.getElementById('quizGameContainer');
        const hangmanGameContainer = document.getElementById('hangmanGameContainer');
        const scrambleGameContainer = document.getElementById('scrambleGameContainer');
        const dictationGameContainer = document.getElementById('dictationGameContainer');
        const matchGameContainer = document.getElementById('matchGameContainer');
        const allContainers = [flashcardGameContainer, quizGameContainer, hangmanGameContainer, scrambleGameContainer, dictationGameContainer, matchGameContainer];
        const allModeBtns = [flashcardModeBtn, quizModeBtn, hangmanModeBtn, scrambleModeBtn, dictationModeBtn, matchModeBtn];

        const quizQuestion = document.getElementById('quizQuestion');
        const quizOptions = document.getElementById('quizOptions');
        const quizScore = document.getElementById('quizScore');

        const hangmanWordDiv = document.getElementById('hangmanWord');
        const hangmanLettersDiv = document.getElementById('hangmanLetters');
        const hangmanParts = ["head", "body", "arm1", "arm2", "leg1", "leg2"];

        const scrambleWordDiv = document.getElementById('scrambleWord');
        const scrambleClueDiv = document.getElementById('scrambleClue');
        const scrambleInput = document.getElementById('scrambleInput');
        const scrambleCheckBtn = document.getElementById('scrambleCheckBtn');
        const scrambleFeedbackDiv = document.getElementById('scrambleFeedback');
        const scrambleNextBtn = document.getElementById('scrambleNextBtn');

        const dictationClueDiv = document.getElementById('dictationClue');
        const dictationInput = document.getElementById('dictationInput');
        const dictationCheckBtn = document.getElementById('dictationCheckBtn');
        const dictationFeedbackDiv = document.getElementById('dictationFeedback');
        const dictationNextBtn = document.getElementById('dictationNextBtn');

        const matchScoreSpan = document.getElementById('matchScore');
        const wordsColumn = document.getElementById('wordsColumn');
        const definitionsColumn = document.getElementById('definitionsColumn');
        const matchNextBtn = document.getElementById('matchNextBtn');

        const chapterSelectorDiv = document.getElementById('chapterSelector');
        const listTitleSummary = document.getElementById('listTitle');
        const alertMessageDiv = document.getElementById('alertMessage');
        const alertTextP = document.getElementById('alertText');

        const categoryModal = document.getElementById('categoryModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalButtons = document.getElementById('modalButtons');

        const varCss = {
            colorCorrect: getComputedStyle(document.documentElement).getPropertyValue('--color-correct').trim(),
            colorIncorrect: getComputedStyle(document.documentElement).getPropertyValue('--color-incorrect').trim(),
            colorPrimary: getComputedStyle(document.documentElement).getPropertyValue('--color-primary').trim(),
            colorCard: getComputedStyle(document.documentElement).getPropertyValue('--color-card').trim(),
            colorText: getComputedStyle(document.documentElement).getPropertyValue('--color-text').trim()
        };

        let vocab = [];
        let currentChapterKey = null;
        let currentSubcategoryKey = null;
        let chapterAlert = null;
        let chosenWord = '';
        let shuffledVocab = [];
        let currentCardIndex = 0;
        let masteredWords = new Set();

        let currentQuizQuestionIndex = 0;
        let quizQuestions = [];
        let score = { correct: 0, total: 0 };

        let hangmanWord = '';
        let guessedLetters = new Set();
        const maxErrors = hangmanParts.length;
        let errors = 0;

        let currentScrambleWord = '';
        let currentDictationWord = '';

        let matchPairs = [];
        let matchedPairsCount = 0;
        let selectedWordItem = null;
        let selectedDefItem = null;
        const MATCH_COUNT = 6;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function hideAllGameContainers() {
            allContainers.forEach(container => {
                container.style.display = 'none';
                container.classList.remove('active-mode');
                setTimeout(() => container.style.opacity = '0', 0);
            });
            allModeBtns.forEach(btn => btn.classList.remove('active'));
        }

        function showGameContainer(container, button) {
            hideAllGameContainers();
            container.style.display = 'flex';
            button.classList.add('active');
            setTimeout(() => {
                container.classList.add('active-mode');
                container.style.opacity = '1';
            }, 50);
        }

        function displayAlert(message, color) {
            alertTextP.textContent = message;
            alertMessageDiv.style.backgroundColor = color;
            alertMessageDiv.style.display = 'block';
        }

        function hideAlert() {
            alertMessageDiv.style.display = 'none';
        }

        function generateChapterButtons() {
            chapterSelectorDiv.innerHTML = '';
            if (typeof ALL_VOCAB_DATA === 'undefined') return;

            Object.entries(ALL_VOCAB_DATA).forEach(([key, chapter]) => {
                const button = document.createElement('button');
                button.id = chapter.selectorId;
                button.textContent = chapter.title;
                button.addEventListener('click', () => openCategoryModal(key, chapter));
                chapterSelectorDiv.appendChild(button);
            });
        }

        function openCategoryModal(chapterKey, chapter) {
            document.querySelectorAll('.chapter-selector button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(chapter.selectorId).classList.add('active');

            trackEvent(`chapitre-${chapterKey}-clicked`);

            modalTitle.textContent = `Choisir la section pour ${chapter.title}`;
            modalButtons.innerHTML = '';
            
            Object.entries(chapter.subcategories).forEach(([subKey, subcategory]) => {
                const button = document.createElement('button');
                button.textContent = subcategory.name;
                button.style.backgroundColor = subcategory.color;
                button.style.color = '#FFFFFF';
                button.addEventListener('click', () => {
                    changeVocabulary(chapterKey, subKey);
                    categoryModal.style.display = 'none';
                });
                modalButtons.appendChild(button);
            });
            categoryModal.style.display = 'flex';
        }

        function changeVocabulary(chapterKey, subcategoryKey) {
            hideAllGameContainers();
            currentChapterKey = chapterKey;
            currentSubcategoryKey = subcategoryKey;
            
            trackEvent(`section-${chapterKey}-${subcategoryKey}-selected`);
            
            if (typeof ALL_VOCAB_DATA === 'undefined') {
                displayAlert("Erreur: Fichier de données (vocab_data.js) manquant ou incorrect.", varCss.colorIncorrect);
                return;
            }

            const chapter = ALL_VOCAB_DATA[chapterKey];
            const subcategory = chapter.subcategories[subcategoryKey];
            vocab = subcategory.data;
            chapterAlert = subcategory.alert;

            listTitleSummary.textContent = `${chapter.title} - ${subcategory.name}`;

            if (chapterAlert && chapterAlert.message) {
                displayAlert(chapterAlert.message, chapterAlert.color || varCss.colorPrimary);
            } else {
                hideAlert();
            }

            generateList();
            startFlashcardGame();
        }

        function generateList() {
            vocabularyList.innerHTML = '';
            vocab.forEach(pair => {
                const li = document.createElement('li');
                li.textContent = `${pair[0]} - ${pair[1]}`;
                vocabularyList.appendChild(li);
            });
        }

        function startFlashcardGame() {
            showGameContainer(flashcardGameContainer, flashcardModeBtn);
            trackEvent('mode-cartes-started');
            flashcard.classList.remove('flipped');
            feedbackButtons.style.display = 'none';
            
            if (vocab.length === 0) {
                 frontFace.textContent = "Sélectionnez un chapitre et une section.";
                 backFace.textContent = "Le jeu commencera après la sélection.";
                 cardCounter.textContent = "";
                 return;
            }

            shuffledVocab = shuffleArray([...vocab]);
            currentCardIndex = 0;
            masteredWords = new Set();
            displayCard();
        }

        function displayCard() {
            if (shuffledVocab.length === 0) {
                frontFace.textContent = "Aucun mot à réviser.";
                backFace.textContent = "";
                cardCounter.textContent = "0 / 0";
                return;
            }
            
            const [word, definition] = shuffledVocab[currentCardIndex];
            frontFace.textContent = word;
            backFace.innerHTML = definition;
            cardCounter.textContent = `${currentCardIndex + 1} / ${shuffledVocab.length}`;
            
            flashcard.classList.remove('flipped');
            feedbackButtons.style.display = 'none';
        }

        function flipCard() {
            if (vocab.length === 0) return;
            
            flashcard.classList.toggle('flipped');
            if (flashcard.classList.contains('flipped')) {
                feedbackButtons.style.display = 'flex';
            }
        }

        function handleFeedback(known) {
            const currentWord = shuffledVocab[currentCardIndex][0];
            
            if (known) {
                masteredWords.add(currentWord);
            } else {
                masteredWords.delete(currentWord);
                
                const wordToReinsert = shuffledVocab.splice(currentCardIndex, 1)[0];
                let insertIndex = currentCardIndex + Math.floor(Math.random() * (shuffledVocab.length - currentCardIndex)) + 1;
                if (insertIndex > shuffledVocab.length) insertIndex = shuffledVocab.length;
                shuffledVocab.splice(insertIndex, 0, wordToReinsert);
                currentCardIndex--;
            }

            currentCardIndex++;
            if (currentCardIndex < shuffledVocab.length) {
                displayCard();
            } else {
                shuffledVocab = shuffledVocab.filter(pair => !masteredWords.has(pair[0]));
                if (shuffledVocab.length > 0) {
                    currentCardIndex = 0;
                    shuffleArray(shuffledVocab);
                    displayAlert(`Nouveau tour avec ${shuffledVocab.length} mots restants!`, varCss.colorPrimary);
                    displayCard();
                } else {
                    frontFace.textContent = "Félicitations! Tu as maîtrisé tous les mots!";
                    backFace.textContent = "Clique sur le bouton 'Mode Cartes' pour recommencer.";
                    cardCounter.textContent = "";
                    feedbackButtons.style.display = 'none';
                    flashcard.classList.remove('flipped');
                }
            }
        }

        flashcard.addEventListener('click', flipCard);
        knewItBtn.addEventListener('click', () => handleFeedback(true));
        didntKnowBtn.addEventListener('click', () => handleFeedback(false));

        function startQuizGame() {
            showGameContainer(quizGameContainer, quizModeBtn);
            trackEvent('mode-quiz-started');
            if (vocab.length === 0) {
                quizQuestion.textContent = "Sélectionnez un chapitre et une section pour commencer.";
                quizOptions.innerHTML = '';
                quizScore.textContent = "Score: 0 / 0";
                return;
            }

            shuffledVocab = shuffleArray([...vocab]);
            quizQuestions = generateQuizQuestions();
            currentQuizQuestionIndex = 0;
            score = { correct: 0, total: 0 };
            displayQuizQuestion();
        }

        function generateQuizQuestions() {
            return shuffledVocab.map(([word, definition]) => {
                const type = Math.random() < 0.5 ? 'wordToDef' : 'defToWord';
                const correctAnswer = type === 'wordToDef' ? definition : word;
                const question = type === 'wordToDef' ? word : definition;
                
                let incorrectAnswers = [];
                let tempVocab = vocab.filter(pair => pair[0] !== word);
                shuffleArray(tempVocab);

                while (incorrectAnswers.length < 3 && tempVocab.length > 0) {
                    const incorrectWord = type === 'wordToDef' ? tempVocab.pop()[1] : tempVocab.pop()[0];
                    if (!incorrectAnswers.includes(incorrectWord)) {
                        incorrectAnswers.push(incorrectWord);
                    }
                }
                
                const options = shuffleArray([correctAnswer, ...incorrectAnswers]).slice(0, 4);

                return { question, correctAnswer, options };
            });
        }

        function displayQuizQuestion() {
            hideAlert();
            if (currentQuizQuestionIndex >= quizQuestions.length) {
                quizQuestion.textContent = `Quiz terminé! Ton score final : ${score.correct} / ${score.total}`;
                quizOptions.innerHTML = `<button onclick="startQuizGame()" style="background: linear-gradient(135deg, var(--color-secondary) 0%, #018786 100%); color: #FFFFFF; border: none;">Recommencer le Quiz</button>`;
                return;
            }

            const q = quizQuestions[currentQuizQuestionIndex];
            quizQuestion.textContent = q.question;
            quizOptions.innerHTML = '';
            
            q.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.addEventListener('click', () => checkQuizAnswer(button, option, q.correctAnswer));
                quizOptions.appendChild(button);
            });
            updateQuizScore();
        }

        function checkQuizAnswer(button, selectedAnswer, correctAnswer) {
            score.total++;
            
            Array.from(quizOptions.children).forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct');
                } else if (btn.textContent === selectedAnswer) {
                    btn.classList.add('incorrect');
                }
            });

                            if (selectedAnswer === correctAnswer) {
                score.correct++;
                displayAlert('Correct!', varCss.colorCorrect);
            } else {
                displayAlert(`Faux. La bonne réponse était : ${correctAnswer}`, varCss.colorIncorrect);
            }
            
            updateQuizScore();
            
            setTimeout(() => {
                currentQuizQuestionIndex++;
                displayQuizQuestion();
            }, 1500);
        }

        function updateQuizScore() {
            quizScore.textContent = `Score: ${score.correct} / ${score.total}`;
            
            if (score.total > 0 && currentQuizQuestionIndex >= quizQuestions.length) {
                trackEvent(`quiz-completed-score-${score.correct}-sur-${score.total}`);
            }
        }

        function startHangGame() {
            showGameContainer(hangmanGameContainer, hangmanModeBtn);
            trackEvent('mode-pendu-started');
             if (vocab.length === 0) {
                hangmanWordDiv.textContent = "Sélectionnez un chapitre pour jouer.";
                hangmanLettersDiv.innerHTML = '';
                return;
            }

            hideAlert();
            
            const randomPair = shuffleArray([...vocab])[0];
            hangmanWord = randomPair[0].toUpperCase();
            guessedLetters = new Set();
            errors = 0;
            
            hangmanParts.forEach(id => document.getElementById(id).style.display = 'none');
            
            hangmanWordDiv.textContent = hangmanWord.split('').map(char => {
                if (char.match(/[A-ZÀ-Ÿ]/i)) return '_';
                return char;
            }).join(' ');

            generateHangButtons();
        }

        function generateHangButtons() {
            hangmanLettersDiv.innerHTML = '';
            
            const baseAlphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split('');
            
            baseAlphabet.forEach(letter => {
                const button = document.createElement('button');
                button.textContent = letter;
                button.value = letter;
                button.addEventListener('click', () => guessLetter(letter, button));
                hangmanLettersDiv.appendChild(button);
            });
        }

        function guessLetter(letter, button) {
            if (button.disabled) return;

            button.disabled = true;
            hideAlert();

            const normalizedWord = hangmanWord.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            const normalizedLetter = letter.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

            if (normalizedWord.includes(normalizedLetter)) {
                button.style.backgroundColor = varCss.colorCorrect;
                
                let updatedDisplay = '';
                let currentWordGuessed = '';
                
                for (let i = 0; i < hangmanWord.length; i++) {
                    const currentLetter = hangmanWord[i].toUpperCase();
                    const normalizedCurrentLetter = currentLetter.normalize("NFD").replace(/[\u0300-\u036f]/g, "");

                    if (normalizedCurrentLetter === normalizedLetter || guessedLetters.has(normalizedCurrentLetter)) {
                        updatedDisplay += currentLetter;
                        currentWordGuessed += currentLetter;
                        guessedLetters.add(normalizedCurrentLetter);
                    } else if (!currentLetter.match(/[A-ZÀ-Ÿ]/i)) {
                         updatedDisplay += currentLetter;
                         currentWordGuessed += currentLetter;
                         guessedLetters.add(normalizedCurrentLetter);
                    }
                    else {
                        updatedDisplay += '_';
                        currentWordGuessed += '_';
                    }
                }
                
                hangmanWordDiv.textContent = updatedDisplay.split('').join(' ');

                if (!currentWordGuessed.includes('_')) {
                    displayAlert(`Gagné ! Le mot était : ${hangmanWord}`, varCss.colorCorrect);
                    trackEvent('pendu-won');
                    disableHangButtons();
                }

            } else {
                button.style.backgroundColor = varCss.colorIncorrect;
                errors++;
                if (errors <= maxErrors) {
                    document.getElementById(hangmanParts[errors - 1]).style.display = 'block';
                }

                if (errors >= maxErrors) {
                    displayAlert(`Perdu ! Le mot était : ${hangmanWord}`, varCss.colorIncorrect);
                    trackEvent('pendu-lost');
                    disableHangButtons();
                }
            }
        }

        function disableHangButtons() {
            Array.from(hangmanLettersDiv.children).forEach(btn => btn.disabled = true);
        }

        function scrambleWord(word) {
            const letters = word.split('');
            for (let i = letters.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [letters[i], letters[j]] = [letters[j], letters[i]];
            }
            return letters.join('');
        }

        function startScrambleGame() {
            showGameContainer(scrambleGameContainer, scrambleModeBtn);
            trackEvent('mode-scramble-started');
            if (vocab.length === 0) {
                scrambleWordDiv.textContent = "Sélectionnez un chapitre pour jouer.";
                scrambleClueDiv.textContent = "";
                scrambleInput.value = '';
                scrambleFeedbackDiv.textContent = '';
                scrambleNextBtn.style.display = 'none';
                scrambleCheckBtn.style.display = 'block';
                return;
            }

            hideAlert();
            scrambleInput.value = '';
            scrambleFeedbackDiv.textContent = '';
            scrambleNextBtn.style.display = 'none';
            scrambleCheckBtn.style.display = 'block';
            
            const randomPair = shuffleArray([...vocab])[0];
            currentScrambleWord = randomPair[0];
            const definition = randomPair[1];

            const scrambled = scrambleWord(currentScrambleWord.toUpperCase().replace(/[\s-]/g, ''));

            scrambleWordDiv.textContent = scrambled.split('').join(' ');
            scrambleClueDiv.textContent = definition;
        }

        function checkScrambleAnswer() {
            const userAnswer = scrambleInput.value.trim().toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[\s-]/g, '');
            const correctWord = currentScrambleWord.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[\s-]/g, '');

            scrambleCheckBtn.style.display = 'none';
            scrambleNextBtn.style.display = 'block';

            if (userAnswer === correctWord) {
                scrambleFeedbackDiv.textContent = `Correct! Le mot était bien : ${currentScrambleWord}`;
                scrambleFeedbackDiv.style.color = varCss.colorCorrect;
            } else {
                scrambleFeedbackDiv.textContent = `Faux. Le mot correct était : ${currentScrambleWord}`;
                scrambleFeedbackDiv.style.color = varCss.colorIncorrect;
            }
        }

        scrambleCheckBtn.addEventListener('click', checkScrambleAnswer);
        scrambleNextBtn.addEventListener('click', startScrambleGame);

        function startDictationGame() {
            showGameContainer(dictationGameContainer, dictationModeBtn);
            trackEvent('mode-dictation-started');
             if (vocab.length === 0) {
                dictationClueDiv.textContent = "Sélectionnez un chapitre pour jouer.";
                dictationInput.value = '';
                dictationFeedbackDiv.textContent = '';
                dictationNextBtn.style.display = 'none';
                dictationCheckBtn.style.display = 'block';
                return;
            }

            hideAlert();
            dictationInput.value = '';
            dictationFeedbackDiv.textContent = '';
            dictationNextBtn.style.display = 'none';
            dictationCheckBtn.style.display = 'block';

            const randomPair = shuffleArray([...vocab])[0];
            currentDictationWord = randomPair[0];
            const definition = randomPair[1];
            
            dictationClueDiv.textContent = definition;
            dictationInput.focus();
        }

        function checkDictationAnswer() {
            const userAnswer = dictationInput.value.trim();
            const correctWord = currentDictationWord;

            dictationCheckBtn.style.display = 'none';
            dictationNextBtn.style.display = 'block';
            
            if (userAnswer === correctWord) {
                dictationFeedbackDiv.textContent = `Exact! Le mot était : ${correctWord}`;
                dictationFeedbackDiv.style.color = varCss.colorCorrect;
            } else {
                dictationFeedbackDiv.textContent = `Incorrect. Le mot exact était : ${correctWord}`;
                dictationFeedbackDiv.style.color = varCss.colorIncorrect;
            }
        }

        dictationCheckBtn.addEventListener('click', checkDictationAnswer);
        dictationNextBtn.addEventListener('click', startDictationGame);

        function startMatchGame() {
            showGameContainer(matchGameContainer, matchModeBtn);
            trackEvent('mode-match-started');
            if (vocab.length === 0) {
                 matchScoreSpan.textContent = "Sélectionnez un chapitre pour jouer.";
                 wordsColumn.innerHTML = '';
                 definitionsColumn.innerHTML = '';
                 return;
            }

            hideAlert();
            wordsColumn.innerHTML = '';
            definitionsColumn.innerHTML = '';
            matchNextBtn.style.display = 'none';
            matchedPairsCount = 0;
            selectedWordItem = null;
            selectedDefItem = null;
            updateMatchScore();

            const pairs = shuffleArray([...vocab]).slice(0, MATCH_COUNT);
            matchPairs = pairs.map(([word, definition]) => ({ word, definition }));

            let words = shuffleArray(matchPairs.map(p => p.word));
            let definitions = shuffleArray(matchPairs.map(p => p.definition));

            words.forEach(word => createMatchItem(wordsColumn, word, 'word'));
            definitions.forEach(def => createMatchItem(definitionsColumn, def, 'definition'));
        }

        function createMatchItem(parent, content, type) {
            const item = document.createElement('div');
            item.classList.add('match-item');
            item.textContent = content;
            item.dataset.type = type;
            item.dataset.value = content;
            item.addEventListener('click', () => handleMatchSelection(item));
            parent.appendChild(item);
        }

        function getMatchPair(item1, item2) {
            const wordValue = item1.dataset.type === 'word' ? item1.dataset.value : item2.dataset.value;
            const defValue = item1.dataset.type === 'definition' ? item1.dataset.value : item2.dataset.value;

            return matchPairs.find(p => p.word === wordValue && p.definition === defValue);
        }

        function handleMatchSelection(item) {
            if (item.classList.contains('matched')) return;

            if (item.dataset.type === 'word') {
                if (selectedWordItem) selectedWordItem.classList.remove('selected');
                selectedWordItem = item;
            } else {
                if (selectedDefItem) selectedDefItem.classList.remove('selected');
                selectedDefItem = item;
            }

            item.classList.add('selected');

            if (selectedWordItem && selectedDefItem) {
                const wordItem = selectedWordItem;
                const defItem = selectedDefItem;

                const pair = getMatchPair(wordItem, defItem);

                if (pair) {
                    matchedPairsCount++;
                    wordItem.classList.remove('selected');
                    defItem.classList.remove('selected');
                    wordItem.classList.add('matched');
                    defItem.classList.add('matched');
                    updateMatchScore();

                    if (matchedPairsCount === MATCH_COUNT) {
                        displayAlert('Félicitations! Toutes les paires trouvées.', varCss.colorCorrect);
                        trackEvent('match-completed');
                        matchNextBtn.style.display = 'block';
                    }
                } else {
                    wordItem.classList.add('error');
                    defItem.classList.add('error');
                    setTimeout(() => {
                        wordItem.classList.remove('error', 'selected');
                        defItem.classList.remove('error', 'selected');
                    }, 1000);
                }
                
                selectedWordItem = null;
                selectedDefItem = null;
            }
        }

        function updateMatchScore() {
            matchScoreSpan.textContent = `Paires trouvées : ${matchedPairsCount} / ${MATCH_COUNT}`;
        }

        matchNextBtn.addEventListener('click', startMatchGame);

        flashcardModeBtn.addEventListener('click', startFlashcardGame);
        quizModeBtn.addEventListener('click', startQuizGame);
        hangmanModeBtn.addEventListener('click', startHangGame);
        scrambleModeBtn.addEventListener('click', startScrambleGame);
        dictationModeBtn.addEventListener('click', startDictationGame);
        matchModeBtn.addEventListener('click', startMatchGame);

        document.addEventListener('DOMContentLoaded', () => {
            generateChapterButtons();
            hideAlert();
            
            frontFace.textContent = "Sélectionnez un chapitre ci-dessus";
            backFace.textContent = "Puis une section pour commencer à jouer.";
        });

        const ADMIN_SECRET_KEY = '4dm1nK3y';

        window.unlockAdminBridge = function(key) {
            if (key === ADMIN_SECRET_KEY) {
                console.log("%c🔑 Clé Administrateur acceptée. Le pont admin est prêt. Les données sont exposées sur window.adminData.", "color: #03DAC6; font-weight: bold;");
                window.adminData = ALL_VOCAB_DATA;
            } else {
                console.error("Clé secrète incorrecte.");
            }
        };

        function trackEvent(eventName) {

        }
    </script>


</body>
</html>
